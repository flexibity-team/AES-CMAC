#include "aes_cbc.h"
#include <sys/types.h>
#include <inttypes.h>

int main(int argc, const char *argv[])
{                                	
	
	uint8_t data[] = 
{ 
    0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 
    0x88, 0x99, 0xaa, 0xbb, 0xcc, 0xdd, 0xee, 0xff,
    
    0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 
    0x88, 0x99, 0xaa, 0xbb, 0xcc, 0xdd, 0xee, 0xff,
    
    0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 
    0x88, 0x99, 0xaa, 0xbb, 0xcc, 0xdd, 0xee, 0xff};
	
	uint8_t key[] = 
	{ 
		0x10, 0x20, 0x30, 0x40, 0x50, 0x60, 0x70, 0x80,
		0x90, 0xa0, 0xb0, 0xc0, 0xd0, 0xe0, 0xf0, 0x00};
		
	uint8_t k1[] = 
	{ 
		0x10, 0x20, 0x30, 0x40, 0x50, 0x60, 0x70, 0x80,
		0x90, 0xa0, 0xb0, 0xc0, 0xd0, 0xe0, 0xf0, 0x00};
		
	uint8_t k2[] = 
	{ 
		0x10, 0x20, 0x30, 0x40, 0x50, 0x60, 0x70, 0x80,
		0x90, 0xa0, 0xb0, 0xc0, 0xd0, 0xe0, 0xf0, 0x00};		
		
	uint8_t iv[]=
	{
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

	uint8_t iv2[]=
	{
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};


	unsigned char mac[16];
	
	int len = sizeof(data);
	int e = 0;
	
	printf("\n DATA \n");
	for(e = 0; e < len; e++){
		printf("%02x, ",data[e] & 0xff);
		}
	int finallen=16;
	if (len % 16 != 0) {
	finallen = len % 16;
	}
		
	uint8_t newdata[len+(16-finallen)];
	
	memcpy(newdata,data,len);
	aes_cbc_encript(newdata,len,key,iv,k1,k2,mac);
	
	printf("\n Criptograma \n");
	for(e = 0; e < len + 8 ; e++){
		printf("%02x, ",newdata[e] & 0xff);
		}
	
	len = sizeof(newdata);
	//printf("\n sizeof %d\n",len);
	
	aes_cbc_decript(newdata,len,key,iv2,k1,k2,mac);
	
	printf("\n DATA \n");
	for(e = 0; e < len; e++){
		printf("%02x, ",newdata[e] & 0xff);
		}
	
	if(memcmp(data,newdata,16)==0){
		printf("\n Equals \n");
		}
	
return 0;
}
